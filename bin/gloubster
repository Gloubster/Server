#!/usr/bin/env php
<?php

use Gloubster\Configuration;
use Gloubster\Server\CLI;
use Gloubster\Server\Console\LogProcess;
use Gloubster\Server\Console\ServerEnsureConfiguration;
use Gloubster\Server\Console\WebsocketServer;

require __DIR__ . '/../vendor/autoload.php';

$conf = new Configuration(file_get_contents(__DIR__ . '/../config/config.json'), array(
        file_get_contents(__DIR__ . '/../resources/configuration.schema.json')
));

try {

    $gloubster = new CLI('Gloubster');

    $gloubster->command(new LogProcess($conf));
    $gloubster->command(new ServerEnsureConfiguration($conf));
    $gloubster->command(new WebsocketServer($conf));

    $gloubster->run();

} catch (\Exception $e) {
    echo sprintf("An error occured : %s", $e->getMessage());
    exit(1);
}
